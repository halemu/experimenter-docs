"use strict";(self.webpackChunkexperimenter_docs=self.webpackChunkexperimenter_docs||[]).push([[6082],{4137:(e,i,n)=>{n.d(i,{Zo:()=>p,kt:()=>u});var t=n(7294);function a(e,i,n){return i in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n,e}function l(e,i){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);i&&(t=t.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,t)}return n}function r(e){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{};i%2?l(Object(n),!0).forEach((function(i){a(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}function o(e,i){if(null==e)return{};var n,t,a=function(e,i){if(null==e)return{};var n,t,a={},l=Object.keys(e);for(t=0;t<l.length;t++)n=l[t],i.indexOf(n)>=0||(a[n]=e[n]);return a}(e,i);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(t=0;t<l.length;t++)n=l[t],i.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var m=t.createContext({}),s=function(e){var i=t.useContext(m),n=i;return e&&(n="function"==typeof e?e(i):r(r({},i),e)),n},p=function(e){var i=s(e.components);return t.createElement(m.Provider,{value:i},e.children)},c="mdxType",f={inlineCode:"code",wrapper:function(e){var i=e.children;return t.createElement(t.Fragment,{},i)}},d=t.forwardRef((function(e,i){var n=e.components,a=e.mdxType,l=e.originalType,m=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),c=s(n),d=a,u=c["".concat(m,".").concat(d)]||c[d]||f[d]||l;return n?t.createElement(u,r(r({ref:i},p),{},{components:n})):t.createElement(u,r({ref:i},p))}));function u(e,i){var n=arguments,a=i&&i.mdxType;if("string"==typeof e||a){var l=n.length,r=new Array(l);r[0]=d;var o={};for(var m in i)hasOwnProperty.call(i,m)&&(o[m]=i[m]);o.originalType=e,o[c]="string"==typeof e?e:a,r[1]=o;for(var s=2;s<l;s++)r[s]=n[s];return t.createElement.apply(null,r)}return t.createElement.apply(null,n)}d.displayName="MDXCreateElement"},7302:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>m,contentTitle:()=>r,default:()=>f,frontMatter:()=>l,metadata:()=>o,toc:()=>s});var t=n(7462),a=(n(7294),n(4137));const l={id:"fml-cli",title:"Nimbus FML command line interface",slug:"/fml/fml-cli",sidebar_position:4},r="Commands",o={unversionedId:"deep-dives/specifications/fml/fml-cli",id:"deep-dives/specifications/fml/fml-cli",title:"Nimbus FML command line interface",description:"Generating code for an mobile application",source:"@site/docs/deep-dives/specifications/fml/fml-cli.mdx",sourceDirName:"deep-dives/specifications/fml",slug:"/fml/fml-cli",permalink:"/fml/fml-cli",draft:!1,editUrl:"https://github.com/mozilla/experimenter-docs/edit/main/docs/deep-dives/specifications/fml/fml-cli.mdx",tags:[],version:"current",sidebarPosition:4,frontMatter:{id:"fml-cli",title:"Nimbus FML command line interface",slug:"/fml/fml-cli",sidebar_position:4},sidebar:"sidebar",previous:{title:"Componentizing the Nimbus Feature Manifest",permalink:"/fml/fml-imports-and-includes"},next:{title:"Co-enrolling Features",permalink:"/fml/coenrolling-features"}},m={},s=[{value:"Generating code for an mobile application",id:"generating-code-for-an-mobile-application",level:2},{value:"Adding <code>repo-file</code>s",id:"adding-repo-files",level:3},{value:"Caching remote files",id:"caching-remote-files",level:3},{value:"Generating a manifest file for experimenter",id:"generating-a-manifest-file-for-experimenter",level:2},{value:"Validating a manifest file",id:"validating-a-manifest-file",level:2},{value:"Re-write a complicated distributed manifest into a single file",id:"re-write-a-complicated-distributed-manifest-into-a-single-file",level:2}],p={toc:s},c="wrapper";function f(e){let{components:i,...n}=e;return(0,a.kt)(c,(0,t.Z)({},p,n,{components:i,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"commands"},"Commands"),(0,a.kt)("h2",{id:"generating-code-for-an-mobile-application"},"Generating code for an mobile application"),(0,a.kt)("p",null,"The simplest invocation is in this form:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"% nimbus-fml generate --language <LANGUAGE> --channel <CHANNEL> <INPUT> <OUTPUT>\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"LANGUAGE")," can be ",(0,a.kt)("inlineCode",{parentName:"li"},"kotlin")," or ",(0,a.kt)("inlineCode",{parentName:"li"},"swift"),"."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"CHANNEL")," is one of the channels specified in the FML file."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"INPUT")," may be a local file or directory."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"OUTPUT")," should be a local file or directory.")),(0,a.kt)("p",null,"If ",(0,a.kt)("inlineCode",{parentName:"p"},"INPUT")," is a directory, it is recursively searches for any files with names ending in ",(0,a.kt)("inlineCode",{parentName:"p"},".fml.yaml"),"."),(0,a.kt)("p",null,"This command should be called at build time of components and the build time of the application."),(0,a.kt)("h3",{id:"adding-repo-files"},"Adding ",(0,a.kt)("inlineCode",{parentName:"h3"},"repo-file"),"s"),(0,a.kt)("p",null,"Adding ",(0,a.kt)("a",{parentName:"p",href:"/fml/fml-paths"},"repo files")," can be done with one or more ",(0,a.kt)("inlineCode",{parentName:"p"},"--repo-file")," argument."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"% nimbus-fml generate --language <LANGUAGE> --repo-file ./app-structure.json <INPUT> <OUTPUT>\n")),(0,a.kt)("h3",{id:"caching-remote-files"},"Caching remote files"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"% nimbus-fml generate --language <LANGUAGE> --channel CHANNEL --cache-dir ./build/cache-dir <INPUT> <OUTPUT>\n")),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"/fml/fml-imports-and-includes"},"For ",(0,a.kt)("inlineCode",{parentName:"a"},"include")," and ",(0,a.kt)("inlineCode",{parentName:"a"},"import")," directives in the FML"),", a remote file may be referenced. The cache directory is a local cache of these remote files."),(0,a.kt)("p",null,"For each of the following, ",(0,a.kt)("inlineCode",{parentName:"p"},"--cache-dir")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"--repo-file")," flags are supported."),(0,a.kt)("h2",{id:"generating-a-manifest-file-for-experimenter"},"Generating a manifest file for experimenter"),(0,a.kt)("p",null,"The reason to use a custom manifest format a language specific JSON serialization library is to do with keeping the code in sync with the experimenter web server."),(0,a.kt)("p",null,"For legacy reasons, this is a different format of yaml file, which should be checked in to version control and is periodically pulled in by experimenter."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"% nimbus-fml generate-experimenter <INPUT> <OUTPUT>\n")),(0,a.kt)("p",null,"This should only be called at the application level, with the one main fml file as an input."),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"--cache-dir")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"--repo-file")," arguments are also supported."),(0,a.kt)("h2",{id:"validating-a-manifest-file"},"Validating a manifest file"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"% nimbus-fml validate <INPUT>\n")),(0,a.kt)("p",null,"This gives a view of the validation process for all channels."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"% nimbus-fml validate @mozilla-mobile/firefox-android/fenix/app/nimbus.fml.yaml\n")),(0,a.kt)("p",null,"gives"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"\u2139\ufe0f Loaded modules:\n- https://raw.githubusercontent.com/mozilla-mobile/firefox-android/main/fenix/app/onboarding.fml.yaml\n- https://raw.githubusercontent.com/mozilla-mobile/firefox-android/main/fenix/app/nimbus.fml.yaml\n- https://raw.githubusercontent.com/mozilla-mobile/firefox-android/main/fenix/app/pbm.fml.yaml\n- https://raw.githubusercontent.com/mozilla-mobile/firefox-android/main/android-components/components/browser/engine-gecko/geckoview.fml.yaml\n- https://raw.githubusercontent.com/mozilla-mobile/firefox-android/main/android-components/components/service/nimbus/messaging.fml.yaml\n\nValidating manifest for different channels:\n\u2705 release.............valid\n\u2705 beta................valid\n\u2705 nightly.............valid\n\u2705 developer...........valid\n")),(0,a.kt)("h2",{id:"re-write-a-complicated-distributed-manifest-into-a-single-file"},"Re-write a complicated distributed manifest into a single file"),(0,a.kt)("p",null,"The FML spec allows you to ",(0,a.kt)("a",{parentName:"p",href:"/fml/fml-imports-and-includes"},"import and include dependencies' manifests"),". This is convenient for engineers to place the feature manifest close to where the feature code lives."),(0,a.kt)("p",null,"However, for some circumstances, it may not be good for packagers or distributers of the software: e.g. if the file is to be distributed with the software."),(0,a.kt)("p",null,"To help this, the ",(0,a.kt)("inlineCode",{parentName:"p"},"single-file")," command is used to merge all imports and includes into the top level file, with a single channel."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"% nimbus-fml single-file --channel release @mozilla-mobile/firefox-android/fenix/app/nimbus.fml.yaml single-file.fml.yaml\n")))}f.isMDXComponent=!0}}]);