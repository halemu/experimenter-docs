"use strict";(self.webpackChunkexperimenter_docs=self.webpackChunkexperimenter_docs||[]).push([[6201],{4137:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>h});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},m=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,p=e.parentName,m=o(e,["components","mdxType","originalType","parentName"]),d=s(n),c=i,h=d["".concat(p,".").concat(c)]||d[c]||u[c]||r;return n?a.createElement(h,l(l({ref:t},m),{},{components:n})):a.createElement(h,l({ref:t},m))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,l=new Array(r);l[0]=c;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o[d]="string"==typeof e?e:i,l[1]=o;for(var s=2;s<r;s++)l[s]=n[s];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},674:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>o,toc:()=>s});var a=n(7462),i=(n(7294),n(4137));const r={id:"nimbus-cli-getting-started",title:"Getting Started",slug:"/nimbus-cli/getting-started"},l=void 0,o={unversionedId:"deep-dives/mobile/nimbus-cli/nimbus-cli-getting-started",id:"deep-dives/mobile/nimbus-cli/nimbus-cli-getting-started",title:"Getting Started",description:"Most nimbus-cli commands need an --app and --channel parameter. These should correspond to the app as it is installed on the simulator or emulator.",source:"@site/docs/deep-dives/mobile/nimbus-cli/20-getting-started.mdx",sourceDirName:"deep-dives/mobile/nimbus-cli",slug:"/nimbus-cli/getting-started",permalink:"/nimbus-cli/getting-started",draft:!1,editUrl:"https://github.com/mozilla/experimenter-docs/edit/main/docs/deep-dives/mobile/nimbus-cli/20-getting-started.mdx",tags:[],version:"current",sidebarPosition:20,frontMatter:{id:"nimbus-cli-getting-started",title:"Getting Started",slug:"/nimbus-cli/getting-started"},sidebar:"sidebar",previous:{title:"Installation Guide",permalink:"/nimbus-cli/install"},next:{title:"Opening and resetting the app",permalink:"/nimbus-cli/opening-and-resetting"}},p={},s=[{value:"<code>list</code>",id:"list",level:2},{value:"<code>enroll</code>",id:"enroll",level:2},{value:"Validating experiments",id:"validating-experiments",level:3},{value:"Testing interactions between experiments and rollouts",id:"testing-interactions-between-experiments-and-rollouts",level:3},{value:"Console output",id:"console-output",level:3},{value:"<code>reset-app</code>",id:"reset-app",level:2},{value:"<code>unenroll</code>",id:"unenroll",level:2},{value:"<code>info</code>",id:"info",level:2}],m={toc:s},d="wrapper";function u(e){let{components:t,...n}=e;return(0,i.kt)(d,(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Most ",(0,i.kt)("inlineCode",{parentName:"p"},"nimbus-cli")," commands need an ",(0,i.kt)("inlineCode",{parentName:"p"},"--app")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"--channel")," parameter. These should correspond to the app as it is installed on the simulator or emulator."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"App Name"),(0,i.kt)("th",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"th"},"--app")," value"),(0,i.kt)("th",{parentName:"tr",align:null},"Available values for ",(0,i.kt)("inlineCode",{parentName:"th"},"--channel")))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Firefox for Android"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"fenix")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"developer"),", ",(0,i.kt)("inlineCode",{parentName:"td"},"nightly"),", ",(0,i.kt)("inlineCode",{parentName:"td"},"beta"),", ",(0,i.kt)("inlineCode",{parentName:"td"},"release"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Firefox for iOS"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"firefox_ios")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"developer"),",",(0,i.kt)("inlineCode",{parentName:"td"},"beta"),", ",(0,i.kt)("inlineCode",{parentName:"td"},"release"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Focus for Android"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"focus_android")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"developer"),", ",(0,i.kt)("inlineCode",{parentName:"td"},"nightly"),", ",(0,i.kt)("inlineCode",{parentName:"td"},"beta"),", ",(0,i.kt)("inlineCode",{parentName:"td"},"release"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Focus for iOS"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"focus_ios")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"developer"),",",(0,i.kt)("inlineCode",{parentName:"td"},"beta"),", ",(0,i.kt)("inlineCode",{parentName:"td"},"release"))))),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"app")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"channel")," are how they are known to Nimbus. The ",(0,i.kt)("inlineCode",{parentName:"p"},"channel")," corresponds to the build type: e.g."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"fenix")," ",(0,i.kt)("inlineCode",{parentName:"li"},"developer")," is the Debug build variant of Firefox for Android."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"firefox_ios")," ",(0,i.kt)("inlineCode",{parentName:"li"},"developer")," is the ",(0,i.kt)("inlineCode",{parentName:"li"},"Fennec")," build configuration of Firefox for iOS.")),(0,i.kt)("p",null,"You can also specify a ",(0,i.kt)("inlineCode",{parentName:"p"},"--device-id")," for working with multiple simulator/emulator/device at the same time."),(0,i.kt)("h2",{id:"list"},(0,i.kt)("inlineCode",{parentName:"h2"},"list")),(0,i.kt)("p",null,"You can find experiments you want to use by using the ",(0,i.kt)("inlineCode",{parentName:"p"},"list")," command."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"nimbus-cli --app fenix --channel developer list\n")),(0,i.kt)("p",null,"The above command gives a formatted table of experiments:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"with the targeted channel,"),(0,i.kt)("li",{parentName:"ul"},"the percentage of eligible users will be enrolled"),(0,i.kt)("li",{parentName:"ul"},"the affected features"),(0,i.kt)("li",{parentName:"ul"},"whether the recipe is an experiment or a rollout (",(0,i.kt)("inlineCode",{parentName:"li"},"R"),")"),(0,i.kt)("li",{parentName:"ul"},"names of the branches")),(0,i.kt)("p",null,"Here is an example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Experiment slug                                                   | Channel |     % | Features                      |   | Branches\n------------------------------------------------------------------+---------+-------+-------------------------------+---+----------------------\n viewpoint-rolling-week-4-expansion-android                       | release |   3 % | messaging                     |   | treatment\n mobile-default-browser-cta-copy-test                             | release |  90 % | messaging                     |   | control, treatment\n lifestyles-images-onboarding-experiment-v3                       | release | 100 % | juno-onboarding               |   | control, treatment-a\n android-research-surface-validation                              | release |  10 % | messaging                     |   | control, treatment\n release-android-onboarding-redesign                              | release | 100 % | juno-onboarding               |   | control, treatment-a\n fx-release-android-re-engagement-notifications-114-rollout       | release | 100 % | re-engagement-notification    | R | control\n notification-worker-validation-experiment                        | nightly | 100 % | messaging                     |   | control, treatment-a\n")),(0,i.kt)("p",null,"You can see the preview collection, by adding a ",(0,i.kt)("inlineCode",{parentName:"p"},"preview")," parameter."),(0,i.kt)("p",null,"By default, this lists what the apps can see: this is coming straight from Remote Settings."),(0,i.kt)("p",null,"If you want to see what is available via the API, then use ",(0,i.kt)("inlineCode",{parentName:"p"},"--use-api"),". It should be noted that this is shows both live and completed experiments, so is likely fairly large, and slow. It will not show ",(0,i.kt)("inlineCode",{parentName:"p"},"preview")," experiments."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"nimbus-cli --app fenix --channel developer list preview\n")),(0,i.kt)("p",null,"You can also use:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"production")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"release"),", or nothing to specify the production server."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"preview")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"production/preview")," to specify the ",(0,i.kt)("inlineCode",{parentName:"li"},"preview")," collection"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"stage")," to specify the staging server"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"stage/preview")," to see the staging server and the preview collection of the staging server.")),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"More information about the experiment can be found with the ",(0,i.kt)("a",{parentName:"p",href:"#info"},(0,i.kt)("inlineCode",{parentName:"a"},"info"))," command.")),(0,i.kt)("p",null,"You can also filter the experiment list by slug, features, channel, or activity status:"),(0,i.kt)("p",null,"Here we do a substring match on features, looking for ",(0,i.kt)("inlineCode",{parentName:"p"},"onboarding")," in any of the features, for experiments in the release channel."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"nimbus-cli --app firefox_ios list --feature onboarding --channel release\n")),(0,i.kt)("p",null,"Here we look for any experiments active (either enrolling or observing). We use the ",(0,i.kt)("inlineCode",{parentName:"p"},"--use-api")," flag because the experiments may not be live anymore."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"nimbus-cli --app firefox_ios list --use-api --active-on 2023-05-01\n")),(0,i.kt)("p",null,"We can use ",(0,i.kt)("inlineCode",{parentName:"p"},"today")," as a shortcut for the current date."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"nimbus-cli --app firefox_ios list --enrolling-on today\n")),(0,i.kt)("h2",{id:"enroll"},(0,i.kt)("inlineCode",{parentName:"h2"},"enroll")),(0,i.kt)("p",null,"You can start the app enrolled in a branch of a given experiment."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"nimbus-cli --app fenix --channel developer \\\n    enroll $EXPERIMENT_SLUG --branch $BRANCH\n")),(0,i.kt)("p",null,"This will download the experiment from Experimenter, and then make changes to it to make it inevitable that the Nimbus SDK will enroll the experiment with that branch:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"changes the channel of the experiment to that of the installed app"),(0,i.kt)("li",{parentName:"ul"},"set the targeting ",(0,i.kt)("inlineCode",{parentName:"li"},'"true"')),(0,i.kt)("li",{parentName:"ul"},"the bucketing for the particular branch as 100%"),(0,i.kt)("li",{parentName:"ul"},"set the enrollment paused flag to ",(0,i.kt)("inlineCode",{parentName:"li"},"false"),".")),(0,i.kt)("p",null,"Once these changes have been made, the app is launched, and the experiment is injected into the SDK."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"nimbus-cli --app fenix --channel developer \\\n    enroll android-research-surface-validation --branch treatment\n")),(0,i.kt)("p",null,"If you're downloading the experiment from ",(0,i.kt)("inlineCode",{parentName:"p"},"preview"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"stage")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"stage/preview"),", you should prepend the server slug to the experiment slug:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"nimbus-cli --app fenix --channel developer \\\n    enroll preview/mobile-default-browser-homepage-banner-copy-test --branch treatment-c\n")),(0,i.kt)("p",null,"You can use the ",(0,i.kt)("inlineCode",{parentName:"p"},"--preserve-targeting")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"--preserve-bucketing")," options to preserve the targeting and bucketing."),(0,i.kt)("p",null,"Enrolled experiments should persist across restarts of the app, and fetching of new experiments is disabled."),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"Occassionally, you may want to get the experiment from Remote Settings rather than Experimenter. You can do this by adding the ",(0,i.kt)("inlineCode",{parentName:"p"},"--use-rs")," flag.")),(0,i.kt)("h3",{id:"validating-experiments"},"Validating experiments"),(0,i.kt)("p",null,"By default, the experiment branches will be validated against the feature manifest. This ",(0,i.kt)("a",{parentName:"p",href:"/nimbus-cli/fml"},"can be configured with ",(0,i.kt)("inlineCode",{parentName:"a"},"--version VERSION"),", ",(0,i.kt)("inlineCode",{parentName:"a"},"--ref REF")," and ",(0,i.kt)("inlineCode",{parentName:"a"},"--manifest FILE")," parameters"),", or disabled with the ",(0,i.kt)("inlineCode",{parentName:"p"},"--no-validate")," parameter."),(0,i.kt)("h3",{id:"testing-interactions-between-experiments-and-rollouts"},"Testing interactions between experiments and rollouts"),(0,i.kt)("p",null,"In addition to an experiment slug and branch, zero or more experiment slugs can be specified."),(0,i.kt)("p",null,"These ",(0,i.kt)("em",{parentName:"p"},"must")," be rollouts. This is to test the interactions between rollouts and experiments acting upon the same feature."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"nimbus-cli --app fenix --channel developer enroll mobile-default-browser-cta-copy-test --branch treatment viewpoint-rolling-week-2-expansion-android\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"--preserve-targeting")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"--preserve-bucketing")," acts on these rollouts too."),(0,i.kt)("h3",{id:"console-output"},"Console output"),(0,i.kt)("p",null,"The corresponding ",(0,i.kt)("inlineCode",{parentName:"p"},"adb")," commands and ",(0,i.kt)("inlineCode",{parentName:"p"},"xcrun")," commands are shown in yellow. These can be useful for attaching to bug reports as part of the Steps To Reproduce (STR). The ",(0,i.kt)("inlineCode",{parentName:"p"},"nimbus-cli")," command used will also be useful for STR."),(0,i.kt)("h2",{id:"reset-app"},(0,i.kt)("inlineCode",{parentName:"h2"},"reset-app")),(0,i.kt)("p",null,"The app can be put back into the just installed state. On Android, there is an ",(0,i.kt)("inlineCode",{parentName:"p"},"adb")," command to do this, but not in iOS. For iOS:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"the app container for the given simulator is deleted."),(0,i.kt)("li",{parentName:"ul"},"the app's group containers for the given simulator are all deleted.")),(0,i.kt)("p",null,"For both the command is the same:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"nimbus-cli --app fenix --channel developer reset-app\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"nimbus-cli --app firefox_ios --channel developer reset-app\n")),(0,i.kt)("h2",{id:"unenroll"},(0,i.kt)("inlineCode",{parentName:"h2"},"unenroll")),(0,i.kt)("p",null,"From time to time you may need to test how the app responds to unenrolling from an experiment. You can force the unenrollment from all previously enrolled experiments with this command."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"nimbus-cli --app fenix --channel developer \\\n    unenroll\n")),(0,i.kt)("h2",{id:"info"},(0,i.kt)("inlineCode",{parentName:"h2"},"info")),(0,i.kt)("p",null,"When you're starting from just the experiment slug, you can use the ",(0,i.kt)("inlineCode",{parentName:"p"},"info")," command to get more information:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"nimbus-cli --app fenix --channel developer info mobile-default-browser-cta-copy-test\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"Slug        mobile-default-browser-cta-copy-test\nName        Mobile Default Browser CTA Copy test\nDescription A copy test on the default browser message on homepage.\nURL         https://experimenter.services.mozilla.com/nimbus/mobile-default-browser-cta-copy-test/summary\nApp         fenix\nChannel     release\nE/R         Experiment with 2 branches\nEnrollment  2023-06-06 \u279e 2023-06-14 (paused)\nObserving   2023-06-06, proposed ending after 29 days\nTargeting   \"(app_version|versionCompare('112.!') >= 0) && (language in ['en'])\"\nBucketing    90 %\nBranches    control, treatment\nFeatures    messaging\n")),(0,i.kt)("p",null,"Notice:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"- `E/R` stands for Experiment or Rollout.\n- the targeting string is a JEXL expression, generated by Experimenter, and is the test all clients must pass in order to be considered _eligible_ for this experiment.\n- the bucketing is the percentage of eligible clients that will enroll in the experiment, across all branches.\n")),(0,i.kt)("p",null,"You can also get this outputed to a file as JSON or YAML with the ",(0,i.kt)("inlineCode",{parentName:"p"},"--output")," parameter."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"nimbus-cli --app fenix --channel developer info mobile-default-browser-cta-copy-test --output info.json\n")),(0,i.kt)("admonition",{title:"Experiment Slugs",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"Experiment identifiers, or slugs, are used to identify experiments and rollouts throughout Nimbus and ",(0,i.kt)("inlineCode",{parentName:"p"},"nimbus-cli"),"."),(0,i.kt)("p",{parentName:"admonition"},"You can copy the slug to the clipboard in Experimenter by pressing the ",(0,i.kt)("img",{src:"/img/nimbus-cli/copy.svg",width:"20"})," icon next to the experiment slug at the top of the summary page:"),(0,i.kt)("img",{title:"Clicking on the copy to clipboard button shows a Copied to Clipboard tooltip",src:"/img/nimbus-cli/copy-to-clipboard-copied.png",width:"40%"}),(0,i.kt)("p",{parentName:"admonition"},"Alternatively, you can use the link you get from Experimenter."),(0,i.kt)("p",{parentName:"admonition"},"e.g."),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"nimbus-cli --app fenix --channel developer \\\n    enroll \\\n    https://experimenter.services.mozilla.com/nimbus/mobile-default-browser-cta-copy-test/summary \\\n    --branch treatment\n")),(0,i.kt)("p",{parentName:"admonition"},"or"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"nimbus-cli --app fenix --channel developer \\\n    info \\\n    https://experimenter.services.mozilla.com/nimbus/viewpoint-rolling-week-4-expansion-android\n"))))}u.isMDXComponent=!0}}]);